[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2017-05-25 14:25:40.221897",
  "name": "Quotation-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch('quotation','value','value');\ncur_frm.add_fetch('quotation','closing_date','closing_date');\ncur_frm.add_fetch('quotation','opportunity_purpose','opportunity_purpose');\ncur_frm.add_fetch('quotation','buying_status','buying_status');\ncur_frm.add_fetch('quotation','stage','stage');\ncur_frm.add_fetch('quotation','competition_status','competition_status');\ncur_frm.add_fetch('quotation','support_needed','support_needed');\n\nfrappe.ui.form.on(\"Quotation\", \"refresh\", function(frm) {\n              cur_frm.add_custom_button(__(\"Make Communication\"), function() {\n\t\t\tfrappe.route_options = {\n\t\t\t\treference_doctype: \"Quotation\",\n                        \treference_name: cur_frm.doc.name,\n                                recipients: cur_frm.doc.contact_email,\n                                phone_no: cur_frm.doc.contact_mobile\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\");\n\t\t});\n               cur_frm.add_custom_button(__(\"Make ToDo\"), function() {\n\t\t\t\n\t\t\tfrappe.set_route(\"List\", \"ToDo\");\n\t\t});\n       \n});\n\nfrappe.ui.form.on(\"Quotation\", \"refresh\", function(frm) {\n        cur_frm.add_custom_button(__('Make Interactions'), cur_frm.cscript['Make Interactions'], __(\"Make\"));\n\t             \n});\n\ncur_frm.cscript['Make Interactions'] = function(cdt, cdn) {\n    frappe.model.open_mapped_doc({\n        method: \"nhance.api.make_interactions_quot\",\n        frm: cur_frm,\n\t\n    })\n}\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Delivery Note",
  "enabled": 1,
  "modified": "2021-07-03 10:37:56.333282",
  "name": "Delivery Note-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "//revision_number\n\nfrappe.ui.form.on(\"Delivery Note Item\", {\n\n\n    batch_no: function(frm, cdt, cdn) {\n        console.log(\"-----------\");\n        //cur_frm.refresh_field(\"items\")\n        var d = locals[cdt][cdn];\n        var item_code = d.item_code;\n\n        var batch_no = d.batch_no;\n        var revision_no = d.revision_number;\n\n        console.log(\"revision_no----------------\" + revision_no);\n\n\n\n        var HasSerialNumber = null;\n        HasSerialNumber = fetch_has_serial_no(item_code);\n        console.log(\"HasSerialNumber\", HasSerialNumber);\n        var HasBatchNumber = null;\n        HasBatchNumber = fetch_has_batch_no(item_code);\n        console.log(\"HasBatchNumber\", HasBatchNumber);\n        var HasRevisionNumber = null;\n        HasRevisionNumber = fetch_has_revision_number(batch_no);\n        console.log(\"HasRevisionNumber\", HasRevisionNumber);\n\n        if ((HasRevisionNumber != null || HasRevisionNumber != undefined || HasRevisionNumber != \"\") && HasBatchNumber == 1) {\n            d.revision_number = HasRevisionNumber;\n        }\n        var df = frappe.meta.get_docfield(\"Delivery Note Item\", \"revision_number\", cur_frm.doc.name);\n\n        df.read_only = 1;\n        cur_frm.refresh_field(\"items\")\n    }\n\n\n})\n\n\nfrappe.ui.form.on(\"Delivery Note Item\", {\n\n\n   serial_no: function(frm, cdt, cdn) {\n        console.log(\"-----------\");\n        //cur_frm.refresh_field(\"items\")\n        var d = locals[cdt][cdn];\n        var item_code = d.item_code;\n\n        var batch_no = d.batch_no;\n        var revision_no = d.revision_number;\n\n        //console.log(\"revision_no----------------\" + revision_no);\n\n\tvar serial_no = d.serial_no;\n\n        //console.log(\"revision_no----------------\" + revision_no);\n\n\n        var HasSerialNumber = null;\n        HasSerialNumber = fetch_has_serial_no(item_code);\n        //console.log(\"HasSerialNumber\", HasSerialNumber);\n        var HasBatchNumber = null;\n        HasBatchNumber = fetch_has_batch_no(item_code);\n        //console.log(\"HasBatchNumber\", HasBatchNumber);\n        var HasRevisionNumberSerial = null;\n        HasRevisionNumberSerial = fetch_has_revision_number_serial(serial_no) ;\n        //console.log(\"HasRevisionNumberSerial\", HasRevisionNumberSerial);\n\n        if ((HasRevisionNumberSerial != null || HasRevisionNumberSerial != undefined || HasRevisionNumberSerial != \"\") && HasSerialNumber == 1) {\n            d.revision_number = HasRevisionNumberSerial;\n        }\n        var df = frappe.meta.get_docfield(\"Delivery Note Item\", \"revision_number\", cur_frm.doc.name);\n\n        df.read_only = 1;\n        cur_frm.refresh_field(\"items\")\n}\n\n})\n\n function fetch_has_serial_no(item_code) {\n    //console.log(\"entered into function\");\n    var has_serial_no = \"\";\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Item',\n            'fieldname': [\"has_serial_no\", \"item_code\"],\n\n            'filters': {\n                item_code: item_code,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_serial_no = r.message.has_serial_no;\n                //console.log(has_serial_no);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_serial_no\n}\n\n\nfunction fetch_has_batch_no(item_code) {\n    //console.log(\"entered into has_batch_no function\");\n    var has_batch_no = \"\";\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Item',\n            'fieldname': [\"has_batch_no\", \"item_code\"],\n\n            'filters': {\n                item_code: item_code,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_batch_no = r.message.has_batch_no;\n                //console.log(has_batch_no);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_batch_no\n}\n\nfunction fetch_has_revision_number(batch_no) {\n    //console.log(\"entered into fetch_has_revision_number function\");\n    var has_revision_number = \"\";\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Batch',\n            'fieldname': [\"revision_number\", \"name\"],\n\n            'filters': {\n                name: batch_no,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_revision_number = r.message.revision_number;\n                //console.log(has_revision_number);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_revision_number\n}\n\n\nfunction fetch_has_revision_number_serial(serial_no) {\n    //console.log(\"entered into fetch_has_revision_number_serial function\");\n    var has_revision_number_serial = \"\";\n    frappe.call({\n           method: 'frappe.client.get_value',\n         args: {\n            'doctype': 'Serial No',\n            'fieldname': [\"revision_number\", \"serial_no\"],\n\n            'filters': {\n                name: serial_no,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_revision_number_serial = r.message.revision_number;\n                //console.log(has_revision_number_serial);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_revision_number_serial\n}\nfrappe.ui.form.on(\"Delivery Note\", \"after_save\", function(frm, cdt, cdn) {\n\n    $.each(frm.doc.items, function(i, d) {\n        var item_code = d.item_code;\n        var revision_number = d.revision_number;\n        //console.log(\"revision_number\", revision_number);\n        if (revision_number != \"\") {\n            var df = frappe.meta.get_docfield(\"Delivery Note Item\", \"revision_number\", cur_frm.doc.name);\n\n            df.read_only = 1;\n        }\n    })\n});\n\n//check item has batch or serial number\n//To check item has serial or batch number\nfrappe.ui.form.on(\"Delivery Note\", \"after_save\", function(frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n    //console.log(\"Entered------\" + d);\n    ////console.log(\"..........\"+JSON.stringify(d));\n    var purpose = frm.doc.purpose;\n    //console.log(\"purpose....\" + purpose);\n    var items = frm.doc.items;\n    // //console.log(\"items.....\"+JSON.stringify(items));\n    for (var i = 0; i < items.length; i++) {\n        var item_code = items[i]['item_code'];\n        var source_warehouse = items[i]['s_warehouse'];\n        //console.log(\"source_warehouse..\" + source_warehouse);\n        var target_warehouse = items[i]['t_warehouse'];\n        //console.log(\"target_warehouse..\" + target_warehouse);\n        var serial_no = items[i]['serial_no'];\n        //console.log(\"serial_no..\" + serial_no);\n        var child_received_qty = items[i]['qty'];\n        //console.log(\"child_received_qty\", child_received_qty);\n        var HasSerialNumber = null;\n        HasSerialNumber = fetch_has_serial_no(item_code);\n        //console.log(\"HasSerialNumber\", HasSerialNumber);\n\tvar HasBatchNumber = null;\n        HasBatchNumber = fetch_has_batch_no(item_code);\n        //console.log(\"HasBatchNumber\", HasBatchNumber);\n\tif(HasSerialNumber == 1 ||HasBatchNumber==1){\n        //console.log(\"item has batch or serial number make feild mandondatory\");\n   \tcur_frm.fields_dict.items.grid.toggle_reqd(\"revision_number\", true)\n        }\n\telse{\n\tconsole.log(\"item has no  batch or no serial number don't make feild mandondatory\");\n\n}//end of else\n    }//end of for loop\n});\n\nfunction fetch_has_serial_no(item_code) {\n    //console.log(\"entered into function\");\n    var has_serial_no = \"\";\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Item',\n            'fieldname': [\"has_serial_no\", \"item_code\"],\n\n            'filters': {\n                item_code: item_code,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_serial_no = r.message.has_serial_no;\n                //console.log(has_serial_no);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_serial_no\n}\n\n\nfunction fetch_has_batch_no(item_code) {\n    //console.log(\"entered into has_batch_no function\");\n    var has_batch_no = \"\";\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Item',\n            'fieldname': [\"has_batch_no\", \"item_code\"],\n\n            'filters': {\n                item_code: item_code,\n            }\n        },\n        async: false,\n        callback: function(r) {\n            if (r.message) {\n                has_batch_no = r.message.has_batch_no;\n                //console.log(has_batch_no);\n                //console.log(\"readings-----------\" + JSON.stringify(r.message));\n\n            }\n        }\n    });\n    return has_batch_no\n}\n\n\n//available qty from stock ledger entry\n\nfrappe.ui.form.on(\"Delivery Note\", \"before_save\", function(frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n    var customer = frm.doc.customer;\n    //console.log(\"customer\", customer);\n    var company = frm.doc.company;\n    //console.log(\"company\", company);\n    var items = frm.doc.items;\n\n    for (var j = 0; j < items.length; j++) {\n        var item_code = items[j]['item_code'];\n        //console.log(\"item_code\", item_code);\n        var status = frm.doc.docstatus;\n        //console.log(\"status\", status);\n        var name = frm.doc.name;\n        //console.log(\"name\", name);\n        var warehouse = items[j]['warehouse'];\n        //console.log(\"warehouse\", warehouse);\n        var posting_date1 = frm.doc.posting_date;\n        //console.log(\"posting_date1\", posting_date1);\n        var posting_time1 = frm.doc.posting_time;\n        //console.log(\"posting_time1\", posting_time1);\n\n        var combined_datetime = posting_date1 + \" \" + posting_time1;\n        //console.log(\"combined_datetime\", combined_datetime);\n        var converted_posting_date = new Date(combined_datetime).getTime();\n        //console.log(\"converted_posting_date\", converted_posting_date);\n        var available_qty_warehouse_date = fetch_qty_at_from_warehouse(item_code, warehouse);\n        //console.log(\"available_qty_warehouse_date\", available_qty_warehouse_date);\n        var available_qty_warehouse_date_beforePostingDate = [];\n        var available_qty_warehouse_date_beforePostingTime = [];\n        var heighest_date;\n        for (var z = 0; z < available_qty_warehouse_date.length; z++) {\n            //var dates=available_qty_warehouse_date[z];\n            available_qty_warehouse_date[z] = new Date(available_qty_warehouse_date[z]).getTime();\n            //console.log(\"date\", available_qty_warehouse_date[z], z);\n            if (available_qty_warehouse_date[z] <= converted_posting_date) {\n                available_qty_warehouse_date_beforePostingDate.push(available_qty_warehouse_date[z]);\n                //console.log(\"available_qty_warehouse_date_beforePostingDate\", available_qty_warehouse_date_beforePostingDate);\n\n            }\n            z = z + 1;\n        }\n        var sorted_date = available_qty_warehouse_date_beforePostingDate.sort();\n        //console.log(\"sorted_date\", sorted_date);\n\n        var heighest_date = sorted_date[sorted_date.length - 1];\n        //console.log(\"heighest_date\", heighest_date);\n        var qty;\n        for (var i = 0; i <= available_qty_warehouse_date.length; i++) {\n            if (heighest_date == available_qty_warehouse_date[i]) {\n                qty = available_qty_warehouse_date[i + 1];\n                //console.log(\"qty\", qty);\n            }\n        }\n\n\n        if (heighest_date != undefined) {\n            //console.log(\"entered in if block\");\n\n            items[j]['pch_available_qty_of_transcation_at_posting_date_and_time'] = qty;\n        } else {\n            //console.log(\"entered in else block\");\n            items[j]['pch_available_qty_of_transcation_at_posting_date_and_time'] = 0;\n        }\n        frm.refresh_field(\"items\")\n    }\n\n\n\n});\n\n\nfunction fetch_qty_at_from_warehouse(item_code, warehouse) {\n    var qty_after_transaction_posting_date = [];\n    frappe.call({\n        method: 'nhance.api.get_stock_qty',\n        args: {\n            \"item_code\": item_code,\n            \"warehouse\": warehouse\n\n        },\n        async: false,\n        callback: function(r) {\n            for (var i = 0; i < r.message.length; i++) {\n                qty_after_transaction_posting_date.push(r.message[i].date);\n                qty_after_transaction_posting_date.push(r.message[i].qty_after_transaction);\n\n            }\n\n\n        }\n    });\n    return qty_after_transaction_posting_date\n}\n\n\n\n\n",
  "view": "Form"
 }
]